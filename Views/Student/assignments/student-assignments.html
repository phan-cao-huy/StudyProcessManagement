<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p - H·ªçc Vi√™n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            background: #34495e;
            text-align: center;
            border-bottom: 1px solid #465a6d;
        }

            .sidebar-header h2 {
                font-size: 18px;
                margin-bottom: 5px;
            }

            .sidebar-header p {
                font-size: 12px;
                color: #95a5a6;
            }

        .sidebar-menu {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .menu-section {
            margin-bottom: 20px;
        }

        .menu-title {
            padding: 10px 20px;
            font-size: 11px;
            color: #95a5a6;
            text-transform: uppercase;
            font-weight: 600;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ecf0f1;
            font-size: 14px;
        }

            .menu-item:hover {
                background: #34495e;
                border-left: 3px solid #3498db;
            }

            .menu-item.active {
                background: #34495e;
                border-left: 3px solid #3498db;
            }

        .sidebar-footer {
            padding: 15px 20px;
            background: #34495e;
            border-top: 1px solid #465a6d;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            background: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-size: 13px;
            font-weight: 600;
        }

        .user-role {
            font-size: 11px;
            color: #95a5a6;
        }

        .btn-logout {
            width: 100%;
            padding: 8px;
            background: #e74c3c;
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .topbar {
            background: white;
            padding: 15px 25px;
            border-bottom: 1px solid #ddd;
        }

            .topbar h1 {
                font-size: 20px;
                color: #333;
                margin-bottom: 5px;
            }

        .breadcrumb {
            font-size: 13px;
            color: #666;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        .filter-bar {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
        }

            .filter-bar select {
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 13px;
                min-width: 200px;
            }

        .assignments-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .assignment-card {
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            padding: 20px;
            transition: all 0.3s;
        }

            .assignment-card:hover {
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            }

        .assignment-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .assignment-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .assignment-course {
            font-size: 12px;
            color: #666;
        }

        .assignment-desc {
            font-size: 13px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .assignment-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 6px;
        }

        .info-item {
            font-size: 12px;
        }

        .info-label {
            color: #999;
            margin-bottom: 3px;
        }

        .info-value {
            color: #333;
            font-weight: 600;
        }

        .assignment-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 12px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-danger {
            background: #ffebee;
            color: #c62828;
        }

        .badge-warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .badge-success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .badge-info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .score-display {
            text-align: center;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .score-number {
            font-size: 32px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .score-label {
            font-size: 12px;
            color: #666;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

            .modal.active {
                display: flex;
            }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

            .modal-header h3 {
                font-size: 18px;
                color: #333;
            }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

            .form-group label {
                display: block;
                margin-bottom: 5px;
                color: #333;
                font-size: 13px;
                font-weight: 600;
            }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
        }

        .file-upload {
            border: 2px dashed #ddd;
            padding: 30px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

            .file-upload:hover {
                border-color: #4CAF50;
                background: #f9f9f9;
            }

            .file-upload i {
                font-size: 48px;
                color: #4CAF50;
                margin-bottom: 10px;
            }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-video {
            background: #e74c3c;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

            .btn-video:hover {
                background: #c0392b;
            }

        /* CSS cho t√†i li·ªáu ƒë√≠nh k√®m */
        .attachment-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: #3498db;
            text-decoration: none;
            font-size: 13px;
            margin-top: 10px;
            padding: 8px 12px;
            background: #e3f2fd;
            border-radius: 6px;
            transition: all 0.3s;
        }

            .attachment-link:hover {
                background: #bbdefb;
            }

        /* CSS cho feedback */
        .feedback-box {
            background: #fff3e0;
            border-left: 4px solid #f57c00;
            padding: 12px;
            margin-top: 10px;
            border-radius: 4px;
        }

        .feedback-title {
            font-weight: 600;
            color: #f57c00;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .feedback-text {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        /* CSS cho badge ƒë·ªông */
        .badge.badge-danger {
            background: #ffebee;
            color: #c62828;
        }

        .badge.badge-warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .badge.badge-success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .badge.badge-info {
            background: #e3f2fd;
            color: #1976d2;
        }
        /* CSS cho feedback */
        .feedback-box {
            background: #fff3e0;
            border-left: 4px solid #f57c00;
            padding: 12px;
            margin-top: 10px;
            border-radius: 4px;
        }

        .feedback-title {
            font-weight: 600;
            color: #f57c00;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .feedback-text {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }
        .assignment-score {
            font-size: 14px;
            font-weight: 700;
            color: #e74c3c; /* M√†u ƒë·ªè cho ƒëi·ªÉm s·ªë */
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- ‚≠ê THAY TH·∫æ: D√πng placeholder cho sidebar -->
    <div id="sidebar-placeholder"></div>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>üéì LMS Student</h2>
            <p>Learning Management System</p>
        </div>

        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-title">T·ªîNG QUAN</div>

                <div class="menu-item" onclick="navigateTo('INFORMATION')">
                    <span>üë§</span>
                    <span>Th√¥ng tin c√° nh√¢n</span>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-title">H·ªåC T·∫¨P</div>

                <div class="menu-item" onclick="location.href='../courses/student-my-courses.html'">
                    <span>üìö</span>
                    <span>Kh√≥a h·ªçc c·ªßa t√¥i</span>
                </div>

            </div>

            <div class="menu-section">
                <div class="menu-title">B√ÄI T·∫¨P & KI·ªÇM TRA</div>
                <div class="menu-item" onclick="navigateToAssignment()">
                    <span>üìù</span>
                    <span>B√†i t·∫≠p</span>
                </div>

            </div>

            <div class="menu-section">
                <div class="menu-title">K·∫æT QU·∫¢</div>

                <div class="menu-item" onclick="navigateTo('GRADES')">
                    <span>üèÜ</span>
                    <span>ƒêi·ªÉm s·ªë</span>
                </div>

            </div>

            <div class="menu-section">
                <div class="menu-title">KH√ÅC</div>
                <div class="menu-item" onclick="navigateTo('CONTENT')">
                    <span>üìÅ</span>
                    <span>T√†i nguy√™n</span>
                </div>

            </div>
        </div>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">S</div>
                <div class="user-details">
                    <div class="user-name">Student</div>
                    <div class="user-role">H·ªçc vi√™n</div>
                </div>
            </div>
            <button class="btn-logout" onclick="logout()">üö™ ƒêƒÉng xu·∫•t</button>
        </div>
    </div>
    <div class="main-content">
        <div class="topbar">
            <h1>B√†i T·∫≠p</h1>
            <div class="breadcrumb">Trang ch·ªß / B√†i t·∫≠p & Ki·ªÉm tra / B√†i t·∫≠p</div>
        </div>

        <div class="content-area">
            <div class="filter-bar">
                <select id="courseFilter" onchange="filterAssignments()">
                    <option value="">T·∫•t c·∫£ kh√≥a h·ªçc</option>
                </select>
                <select id="statusFilter" onchange="filterAssignments()">
                    <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                    <option value="Ch∆∞a n·ªôp">Ch∆∞a n·ªôp</option>
                    <option value="Ch·ªù ch·∫•m">Ch·ªù ch·∫•m</option>
                    <option value="ƒê√£ ch·∫•m">ƒê√£ ch·∫•m</option>
                    <option value="Qu√° h·∫°n">Qu√° h·∫°n</option>
                </select>
            </div>

            <div class="assignments-grid" id="assignmentsContainer">
            </div>
        </div>
    </div>

    <div class="modal" id="submitModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>N·ªôp b√†i t·∫≠p</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="currentAssignmentId">
                <div class="form-group">
                    <label>T√™n b√†i t·∫≠p</label>
                    <input type="text" class="form-control" id="assignmentName" disabled>
                </div>
                <div class="form-group">
                    <label>Kh√≥a h·ªçc</label>
                    <input type="text" class="form-control" id="courseName" disabled>
                </div>
                <div class="form-group">
                    <label>H·∫°n n·ªôp</label>
                    <input type="text" class="form-control" id="dueDate" disabled>
                </div>
                <div class="form-group">
                    <label>File n·ªôp b√†i *</label>
                    <input type="file" class="form-control" id="fileUpload" accept=".zip,.rar,.pdf">
                </div>
                <div class="form-group">
                    <label>Ghi ch√∫</label>
                    <textarea class="form-control" id="studentNote" rows="4" placeholder="Nh·∫≠p ghi ch√∫ n·∫øu c√≥..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" style="background: #999; color: white;" onclick="closeModal()">H·ªßy</button>
                <button class="btn btn-success" onclick="submitAssignment()">üì§ N·ªôp b√†i</button>
            </div>
        </div>
    </div>

    <div id="detailModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-button" onclick="closeDetailModal()">&times;</span>
            <h3 id="detailModalTitle" style="color: #2980b9;">Chi Ti·∫øt B√†i T·∫≠p</h3>

            <div class="detail-section">
                <p><strong>B√†i t·∫≠p:</strong> <span id="detailAssignmentName" class="detail-value"></span></p>
                <p><strong>Kh√≥a h·ªçc:</strong> <span id="detailCourseName" class="detail-value"></span></p>
                <p><strong>Tr·∫°ng th√°i:</strong> <span id="detailStatus" class="detail-value"></span></p>
            </div>

            <div class="detail-section">
                <h4>M√¥ t·∫£</h4>
                <div id="detailDescription" class="detail-value note-display"></div>
            </div>

            <div id="detailScoreSection" class="detail-section" style="display:none;">
                <h4>K·∫øt qu·∫£ ch·∫•m ƒëi·ªÉm</h4>
                <p><strong>ƒêi·ªÉm ƒë·∫°t:</strong> <span id="detailScore" class="detail-value"></span></p>
            </div>

            <div id="detailTeacherNoteSection" class="detail-section" style="display:none;">
                <h4>Ghi ch√∫ Gi√°o vi√™n</h4>
                <div id="detailTeacherNote" class="detail-value note-display teacher-note-highlight"></div>
            </div>

            <button class="btn btn-primary" onclick="closeDetailModal()" style="margin-top: 20px;">ƒê√≥ng</button>
        </div>
    </div>

    <div class="modal" id="feedbackModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nh·∫≠n x√©t t·ª´ Gi·∫£ng vi√™n</h3>
                <button class="close-btn" onclick="closeFeedbackModal()">&times;</button>
            </div>
            <div class="modal-body" id="feedbackContent">
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeFeedbackModal()">ƒê√≥ng</button>
            </div>
        </div>
    </div>
    <script>
        let assignmentData = [];

        window.updateAssignments = function (jsonString) {
            try {
                assignmentData = JSON.parse(jsonString);
                loadAssignments(assignmentData);
            } catch (e) {
                console.error("L·ªói khi parse d·ªØ li·ªáu b√†i t·∫≠p t·ª´ C#:", e);
                // C√≥ th·ªÉ hi·ªÉn th·ªã th√¥ng b√°o l·ªói cho ng∆∞·ªùi d√πng n·∫øu c·∫ßn
            }
        }
        // ‚≠ê H√ÄM N·ªòP B√ÄI M·ªöI (C·∫¶N T√äN KH√ìA H·ªåC) ‚≠ê
        function submitAssignment(assignmentId) {
            // ƒê·∫£m b·∫£o ID input file v√† textarea ghi ch√∫ c·ªßa b·∫°n ƒë√∫ng
            const fileInput = document.getElementById('submissionFile');
            const studentNoteElement = document.getElementById('studentNote');

            // Gi·∫£ s·ª≠ assignmentData l√† m·∫£ng/object global ƒë√£ ƒë∆∞·ª£c C# t·∫£i v√†o trang
            // B·∫†N PH·∫¢I ƒê·∫¢M B·∫¢O assignmentData T·ªíN T·∫†I V√Ä C√ì TR∆Ø·ªúNG 'tenKhoaHoc'
            const assignment = assignmentData.find(a => a.assignmentID == assignmentId);

            if (!assignment) {
                alert('L·ªói: Kh√¥ng t√¨m th·∫•y b√†i t·∫≠p (ID ' + assignmentId + ').');
                return;
            }

            if (!fileInput || fileInput.files.length === 0) {
                alert('Vui l√≤ng ch·ªçn file ƒë·ªÉ n·ªôp b√†i.');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            // S·ª≠ d·ª•ng h√†m ƒë√≥ng modal c·ªßa b·∫°n
            const closeModalFunc = typeof closeSubmitModal === 'function' ? closeSubmitModal : closeModal;

            reader.onload = function (event) {
                // L·∫•y Base64 string (lo·∫°i b·ªè ph·∫ßn header "data:mime/type;base64,")
                const base64Data = event.target.result.split(',').pop();

                // 1. T·∫†O ƒê·ªêI T∆Ø·ª¢NG JSON V·ªöI ACTION V√Ä D·ªÆ LI·ªÜU ƒê·∫¶Y ƒê·ª¶
                const submissionData = {
                    Action: "SUBMIT_ASSIGNMENT_SAVE_LOCAL", // ‚≠ê Action m√† C# ƒëang l·∫Øng nghe
                    AssignmentID: assignmentId,
                    FileName: file.name,
                    FileBase64: base64Data,
                    StudentNote: studentNoteElement ? studentNoteElement.value : "",
                    CourseName: assignment.tenKhoaHoc // ‚≠ê D·ªØ li·ªáu b·∫Øt bu·ªôc C# c·∫ßn ƒë·ªÉ t·∫°o folder
                };

                const jsonString = JSON.stringify(submissionData);

                // 2. G·ª≠i th√¥ng ƒëi·ªáp ƒë·∫øn C#
                if (window.chrome && window.chrome.webview) {
                    window.chrome.webview.postMessage(jsonString);

                    closeModalFunc();
                    alert(`B√†i t·∫≠p "${assignment.tenBaiTap}" ƒëang ƒë∆∞·ª£c g·ª≠i... Vui l√≤ng ƒë·ª£i th√¥ng b√°o x√°c nh·∫≠n.`);

                } else {
                    alert('L·ªói: ·ª®ng d·ª•ng kh√¥ng ch·∫°y trong m√¥i tr∆∞·ªùng WebView2. Kh√¥ng th·ªÉ n·ªôp file.');
                }
            };

            reader.readAsDataURL(file);
        }

        // ‚≠ê H√ÄM PH·∫¢N H·ªíI T·ª™ C# ‚≠ê
        // C# s·∫Ω g·ªçi h√†m n√†y sau khi l∆∞u file v√† c·∫≠p nh·∫≠t DB ƒë·ªÉ hi·ªÉn th·ªã k·∫øt qu·∫£ cu·ªëi c√πng
        function handleSubmissionResponse(assignmentId, isSuccess, message) {
            // T√πy ch·ªânh vi·ªác hi·ªÉn th·ªã k·∫øt qu·∫£ v√† t·∫£i l·∫°i d·ªØ li·ªáu t·∫°i ƒë√¢y
            if (isSuccess) {
                alert("N·ªòP B√ÄI TH√ÄNH C√îNG!\n" + message);
                // V√≠ d·ª•: G·ªçi h√†m ƒëi·ªÅu h∆∞·ªõng ƒë·ªÉ t·∫£i l·∫°i trang danh s√°ch b√†i t·∫≠p
                // navigateTo('ASSIGNMENT'); 
            } else {
                alert("N·ªòP B√ÄI TH·∫§T B·∫†I!\n" + message);
            }
        }
        function getBadgeClass(status) {
            switch (status) {
                case 'ƒê√£ ch·∫•m': return 'badge-success';
                case 'Ch·ªù ch·∫•m': return 'badge-warning';
                case 'Ch∆∞a n·ªôp': return 'badge-info';
                case 'Qu√° h·∫°n': return 'badge-danger';
                default: return 'badge-info';
            }
        }

        function renderAssignmentCard(assignment) {
            const badgeClass = assignment.statusColor;
            let infoDetails = '';
            let actionButtons = '';
            let scoreSection = '';
            let teacherNoteButton = ''; // <-- TH√äM: Bi·∫øn l∆∞u tr·ªØ n√∫t Ghi ch√∫
            let HanNopDisplay = assignment.hanNopFormat;
            let GiaoNgayDisplay = assignment.ngayGiaoFormat;

            // X·ª≠ l√Ω hi·ªÉn th·ªã ƒëi·ªÉm
            if (assignment.diemDat !== null) {
                scoreSection = `
            <div class="score-display">
                <div class="score-number">${assignment.diemDat}</div>
                <div class="score-label">ƒêi·ªÉm / <span style="font-weight: normal;">${assignment.diemToiDa}</span></div>
            </div>
        `;

                // ‚≠ê LOGIC M·ªöI: T·∫†O N√öT GHI CH√ö GI√ÅO VI√äN ‚≠ê
                // Gi·∫£ ƒë·ªãnh thu·ªôc t√≠nh ghi ch√∫ gi√°o vi√™n l√† 'ghiChuGiaoVien'
                if (assignment.nhanXetGiaoVien) {
                    teacherNoteButton = `
                <button class="btn btn-info" onclick="showTeacherNote('${assignment.assignmentID}')" style="background-color: #3498db; color: white; margin-right: 10px;">üí¨ Ghi ch√∫ Gi√°o vi√™n</button>
            `;
                }
            }

            // X·ª≠ l√Ω hi·ªÉn th·ªã chi ti·∫øt n·ªôp/h·∫°n n·ªôp (Gi·ªØ nguy√™n)
            if (assignment.ngayNopFormat) {
                infoDetails += `
            <div class="info-item">
                <div class="info-label">ƒê√£ n·ªôp:</div>
                <div class="info-value">${assignment.ngayNopFormat} ${assignment.daNopTre ? '<span style="color: #c0392b;">(N·ªôp tr·ªÖ)</span>' : ''}</div>
            </div>
        `;
                // N·∫øu ƒë√£ n·ªôp, hi·ªÉn th·ªã H·∫°n n·ªôp
                infoDetails += `
            <div class="info-item">
                <div class="info-label">H·∫°n n·ªôp:</div>
                <div class="info-value">${HanNopDisplay}</div>
            </div>
        `;
            } else {
                // N·∫øu ch∆∞a n·ªôp, hi·ªÉn th·ªã Th·ªùi gian c√≤n l·∫°i v√† H·∫°n n·ªôp
                infoDetails += `
            <div class="info-item">
                <div class="info-label">${assignment.trangThai === 'Qu√° h·∫°n' ? 'ƒê√£ qu√° h·∫°n:' : 'Th·ªùi gian c√≤n:'}</div>
                <div class="info-value" style="color: ${assignment.trangThai === 'Qu√° h·∫°n' ? '#c62828' : '#1976d2'};">${assignment.thoiGianConLai}</div>
            </div>
        `;
                infoDetails += `
            <div class="info-item">
                <div class="info-label">H·∫°n n·ªôp:</div>
                <div class="info-value" style="color: ${assignment.trangThai === 'Qu√° h·∫°n' ? '#c62828' : '#333'};">${HanNopDisplay}</div>
            </div>
        `;
            }

            // X·ª≠ l√Ω n√∫t h√†nh ƒë·ªông
            if (assignment.diemDat !== null) {
                // ‚≠ê S·ª¨A ƒê·ªîI: ƒê√£ ch·∫•m ƒëi·ªÉm, hi·ªÉn th·ªã Ghi ch√∫ (n·∫øu c√≥) v√† Xem chi ti·∫øt ‚≠ê
                actionButtons = `
            ${teacherNoteButton}
            <button class="btn btn-primary" onclick="openDetailModal('${assignment.assignmentID}')">üëÅÔ∏è Xem chi ti·∫øt</button>
        `;
            } else if (assignment.daHoanThanh) {
                // ƒê√£ n·ªôp, ch·ªù ch·∫•m
                actionButtons = `
            <button class="btn btn-success" disabled>‚úÖ ƒê√£ n·ªôp</button>
            <button class="btn btn-primary" onclick="openDetailModal(${assignment.assignmentID})">üëÅÔ∏è Xem b√†i n·ªôp</button>
        `;
            } else {
                // Ch∆∞a n·ªôp / Qu√° h·∫°n
                actionButtons = `
            <button class="btn btn-success" onclick="openSubmitModal(${assignment.assignmentID})">üì§ N·ªôp b√†i</button>
            <button class="btn btn-primary" onclick="openDetailModal(${assignment.assignmentID})">üìã Chi ti·∫øt</button>
        `;
            }

            // ... (Ph·∫ßn HTML tr·∫£ v·ªÅ - Gi·ªØ nguy√™n)
            return `
        <div class="assignment-card" data-assignment-id="${assignment.assignmentID}" data-course="${assignment.tenKhoaHoc}" data-status="${assignment.trangThai}">
            <div class="assignment-header">
                <div>
                    <div class="assignment-title">${assignment.tenBaiTap}</div>
                    <div class="assignment-course">üìö ${assignment.tenKhoaHoc}</div>
                </div>
                <span class="badge ${badgeClass}">${assignment.trangThai}</span>
            </div>

            ${scoreSection}

            <div class="assignment-desc">
                ${assignment.moTa}
                ${assignment.taiLieuDinhKem ? `<a href="#" class="attachment-link" onclick="event.preventDefault(); alert('ƒêang t·∫£i t√†i li·ªáu: ${assignment.taiLieuDinhKem}');">üìé T·∫£i T√†i li·ªáu ƒë√≠nh k√®m</a>` : ''}
            </div>

            <div class="assignment-info">
                <div class="info-item">
                    <div class="info-label">Giao ng√†y:</div>
                    <div class="info-value">${GiaoNgayDisplay}</div>
                </div>
                ${infoDetails}
            </div>

            <div class="assignment-actions">
                ${actionButtons}
            </div>
        </div>
    `;
        }

        function loadAssignments(data) {
            const container = document.getElementById('assignmentsContainer');
            container.innerHTML = data.map(renderAssignmentCard).join('');

            populateCourseFilter(data);
        }

        function populateCourseFilter(data) {
            const select = document.getElementById('courseFilter');
            const courses = [...new Set(data.map(a => a.tenKhoaHoc))];

            select.innerHTML = '<option value="">T·∫•t c·∫£ kh√≥a h·ªçc</option>';

            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course;
                option.textContent = course;
                select.appendChild(option);
            });
        }

        function filterAssignments() {
            const course = document.getElementById('courseFilter').value;
            const status = document.getElementById('statusFilter').value;
            const cards = document.querySelectorAll('.assignment-card');

            cards.forEach(card => {
                const cardCourse = card.getAttribute('data-course');
                const cardStatus = card.getAttribute('data-status');

                const courseMatch = !course || cardCourse === course;
                const statusMatch = !status || cardStatus === status;

                card.style.display = (courseMatch && statusMatch) ? 'block' : 'none';
            });
        }

        function openSubmitModal(assignmentIdString) {
            // ‚≠ê B∆Ø·ªöC 1: G√ÅN ID NGAY L·∫¨P T·ª®C CHO INPUT ·∫®N ‚≠ê
            document.getElementById('currentAssignmentId').value = assignmentIdString;

            // Ki·ªÉm tra chu·ªói b·ªã l·ªói t·ª´ C# (khi C# g·ª≠i null v√† n√≥ b·ªã stringify th√†nh 'null')
            if (assignmentIdString === 'null' || assignmentIdString === 'undefined' || !assignmentIdString) {
                alert('L·ªói D·ªÆ LI·ªÜU C#: ID b√†i t·∫≠p b·ªã thi·∫øu ho·∫∑c kh√¥ng ph·∫£i l√† s·ªë. Vui l√≤ng ki·ªÉm tra d·ªØ li·ªáu tr·∫£ v·ªÅ t·ª´ C#.');
                return;
            }

            // Chuy·ªÉn chu·ªói th√†nh s·ªë ƒë·ªÉ ki·ªÉm tra v√† t√¨m ki·∫øm
            const assignmentId = parseInt(assignmentIdString);

            // Ki·ªÉm tra t√≠nh h·ª£p l·ªá c·ªßa ID sau khi parse (NaN)
            if (isNaN(assignmentId)) {
                // L·ªói n√†y x·∫£y ra khi chu·ªói l√† NaN (v√≠ d·ª•: 'abc')
                alert('L·ªói n·ªôi b·ªô: ID b√†i t·∫≠p kh√¥ng ph·∫£i l√† s·ªë h·ª£p l·ªá. Vui l√≤ng t·∫£i l·∫°i trang.');
                return;
            }

            const assignment = assignmentData.find(a => a.assignmentID === assignmentId);

            if (assignment) {
                document.getElementById('assignmentName').value = assignment.tenBaiTap;
                document.getElementById('courseName').value = assignment.tenKhoaHoc;
                document.getElementById('dueDate').value = assignment.hanNopFormat;
                document.getElementById('studentNote').value = assignment.ghiChuSinhVien || '';
            } else {
                console.error('L·ªñI D·ªÆ LI·ªÜU: Kh√¥ng t√¨m th·∫•y chi ti·∫øt b√†i t·∫≠p trong assignmentData (ID: ' + assignmentId + ').');
                document.getElementById('assignmentName').value = 'L·ªñI T·∫¢I D·ªÆ LI·ªÜU';
                document.getElementById('courseName').value = 'L·ªñI T·∫¢I D·ªÆ LI·ªÜU';
                document.getElementById('dueDate').value = '';
                document.getElementById('studentNote').value = '';
            }

            document.getElementById('fileUpload').value = '';
            document.getElementById('submitModal').classList.add('active');
        }
        // ‚≠ê H√ÄM M·ªöI: M·ªü modal nh·∫≠n x√©t gi√°o vi√™n ‚≠ê
        function openFeedbackModal(assignmentId) {
            const assignment = assignmentData.find(a => a.assignmentID === assignmentId);
            if (!assignment) return;

            const feedbackContent = document.getElementById('feedbackContent');

            let html = `
                            <h4>Nh·∫≠n x√©t b√†i t·∫≠p: ${assignment.tenBaiTap}</h4>
                            <hr style="margin: 10px 0;">
                            <p><strong>Kh√≥a h·ªçc:</strong> ${assignment.tenKhoaHoc}</p>

                            <br>

                            <h5 style="margin-top: 15px;">üí¨ Nh·∫≠n x√©t c·ªßa Gi·∫£ng vi√™n:</h5>
                            <div class="feedback-box" style="margin-top: 0;">
                                <div class="feedback-text">${assignment.nhanXetGiaoVien || 'Gi·∫£ng vi√™n ch∆∞a g·ª≠i nh·∫≠n x√©t chi ti·∫øt cho b√†i t·∫≠p n√†y.'}</div>
                            </div>
                        `;

            feedbackContent.innerHTML = html;
            document.getElementById('feedbackModal').classList.add('active');
        }

        // ‚≠ê H√ÄM M·ªöI: ƒê√≥ng modal nh·∫≠n x√©t ‚≠ê
        function closeFeedbackModal() {
            document.getElementById('feedbackModal').classList.remove('active');
        }

        // H√†m m·ªü modal chi ti·∫øt b√†i t·∫≠p (D√†nh cho Xem b√†i n·ªôp v√† Chi ti·∫øt chung)
        function openDetailModal(assignmentId) {
            const assignment = assignmentData.find(a => a.assignmentID === assignmentId);
            if (!assignment) return;

            const detailContent = document.getElementById('detailContent');

            // X√¢y d·ª±ng n·ªôi dung chi ti·∫øt
            let html = `
                            <h4>${assignment.tenBaiTap} - ${assignment.tenKhoaHoc}</h4>
                            <hr style="margin: 10px 0;">
                            <p><strong>M√¥ t·∫£:</strong> ${assignment.moTa}</p>
                            <p><strong>H·∫°n n·ªôp:</strong> ${assignment.hanNopFormat}</p>
                            <p><strong>ƒêi·ªÉm t·ªëi ƒëa:</strong> ${assignment.diemToiDa}</p>
                            <p><strong>Tr·∫°ng th√°i:</strong> <span class="badge ${assignment.statusColor}">${assignment.trangThai}</span></p>
                            <br>
                        `;

            if (assignment.fileBaiNop) {
                html += `
                                <h5>üìÇ Th√¥ng tin b√†i n·ªôp:</h5>
                                <p><strong>File n·ªôp:</strong> <a href="#" onclick="event.preventDefault(); alert('T·∫£i file ${assignment.fileBaiNop}');">${assignment.fileBaiNop}</a></p>
                                <p><strong>Ng√†y n·ªôp:</strong> ${assignment.ngayNopFormat} ${assignment.daNopTre ? '(N·ªôp tr·ªÖ)' : ''}</p>
                                ${assignment.ghiChuSinhVien ? `<p><strong>Ghi ch√∫:</strong> ${assignment.ghiChuSinhVien}</p>` : ''}
                            `;
            } else {
                html += `<p><strong>Tr·∫°ng th√°i n·ªôp:</strong> Ch∆∞a c√≥ b√†i n·ªôp.</p>`;
            }

            if (assignment.diemDat !== null) {
                html += `
                                <h5 style="margin-top: 15px;">üíØ K·∫øt qu·∫£:</h5>
                                <div class="score-display" style="background: #e8f5e9; border: 1px solid #4CAF50;">
                                    <div class="score-number" style="color: #4CAF50;">${assignment.diemDat}</div>
                                    <div class="score-label">ƒêi·ªÉm ƒë·∫°t / ${assignment.diemToiDa}</div>
                                </div>
                            `;
                // V·∫´n hi·ªÉn th·ªã nh·∫≠n x√©t trong modal chi ti·∫øt n·∫øu c√≥
                if (assignment.nhanXetGiaoVien) {
                    html += `
                                    <h5 style="margin-top: 15px;">üí¨ Nh·∫≠n x√©t c·ªßa Gi·∫£ng vi√™n (Chi ti·∫øt):</h5>
                                    <div class="feedback-box">
                                        <div class="feedback-text">${assignment.nhanXetGiaoVien}</div>
                                    </div>
                                `;
                }
            }

            detailContent.innerHTML = html;
            document.getElementById('detailModal').classList.add('active');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        function submitAssignment() {
            console.log('1. CLICK EVENT ƒê√É ƒê∆Ø·ª¢C K√çCH HO·∫†T. B·∫ÆT ƒê·∫¶U KI·ªÇM TRA ƒêI·ªÄU KI·ªÜN.');

            // ƒê·ªçc gi√° tr·ªã t·ª´ input (ƒë√¢y l√† chu·ªói, c√≥ th·ªÉ l√† "" n·∫øu ch∆∞a ƒë∆∞·ª£c g√°n)
            const assignmentIdString = document.getElementById('currentAssignmentId').value;
            const fileInput = document.getElementById('fileUpload').files[0];
            const studentNote = document.getElementById('studentNote').value;

            // Chuy·ªÉn chu·ªói ID th√†nh s·ªë v√† ki·ªÉm tra t√≠nh h·ª£p l·ªá
            const assignmentId = parseInt(assignmentIdString);

            console.log('DEBUG: AssignmentID t·ª´ input (string):', assignmentIdString);
            console.log('DEBUG: AssignmentID ƒë√£ parse (number):', assignmentId);

            // ‚≠ê B∆Ø·ªöC KH·∫ÆC PH·ª§C: KI·ªÇM TRA ID H·ª¢P L·ªÜ (Kh√¥ng ph·∫£i NaN ho·∫∑c chu·ªói r·ªóng) ‚≠ê
            if (isNaN(assignmentId) || !assignmentIdString) {
                console.error('2. D·ª™NG: ID b√†i t·∫≠p kh√¥ng h·ª£p l·ªá (NaN/Empty). Qu√° tr√¨nh g√°n ID b·ªã l·ªói.');
                alert('L·ªói: Kh√¥ng t√¨m th·∫•y ID b√†i t·∫≠p. Vui l√≤ng m·ªü l·∫°i modal th√¥ng qua n√∫t "N·ªôp b√†i" tr√™n th·∫ª b√†i t·∫≠p.');
                closeModal();
                return;
            }

            // T√¨m ƒë·ªëi t∆∞·ª£ng b√†i t·∫≠p b·∫±ng ID ƒë√£ parse
            const index = assignmentData.findIndex(a => a.assignmentID === assignmentId);
            const assignment = assignmentData[index];

            console.log('DEBUG: Assignment Object:', assignment);

            // Ki·ªÉm tra ƒë·ªëi t∆∞·ª£ng b√†i t·∫≠p c√≥ t·ªìn t·∫°i kh√¥ng
            if (!assignment) {
                console.error('2. D·ª™NG: Kh√¥ng t√¨m th·∫•y ƒë·ªëi t∆∞·ª£ng b√†i t·∫≠p trong assignmentData.');
                alert('L·ªói: Kh√¥ng t√¨m th·∫•y chi ti·∫øt b√†i t·∫≠p trong d·ªØ li·ªáu h·ªá th·ªëng. Vui l√≤ng t·∫£i l·∫°i trang.');
                closeModal();
                return;
            }

            // 1. Logic ch·∫∑n qu√° h·∫°n (B√¢y gi·ªù ƒë√£ ch·∫Øc ch·∫Øn c√≥ ƒë·ªëi t∆∞·ª£ng assignment)
            if (assignment.trangThai === 'Qu√° h·∫°n') {
                console.log('2. D·ª™NG: B√†i t·∫≠p ƒë√£ qu√° h·∫°n.');
                alert(`B√†i t·∫≠p "${assignment.tenBaiTap}" ƒë√£ qu√° h·∫°n n·ªôp (${assignment.hanNopFormat}).\n\nH·ªá th·ªëng ƒë√£ kh√≥a ch·ª©c nƒÉng n·ªôp b√†i. Vui l√≤ng li√™n h·ªá Gi·∫£ng vi√™n ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£.`);
                closeModal();
                return;
            }

            if (!fileInput) {
                console.log('2. D·ª™NG: Thi·∫øu file b√†i n·ªôp.');
                alert('Vui l√≤ng ch·ªçn file b√†i n·ªôp.');
                return;
            }

            if (!(window.chrome && window.chrome.webview)) {
                console.log('3. D·ª™NG: M√¥i tr∆∞·ªùng kh√¥ng ph·∫£i WebView2.');
                alert('L·ªói: Ch·ª©c nƒÉng n·ªôp b√†i ch·ªâ ho·∫°t ƒë·ªông trong m√¥i tr∆∞·ªùng ·ª©ng d·ª•ng (WebView2).');
                return;
            }

            console.log('4. TH√ÄNH C√îNG: ƒê√£ v∆∞·ª£t qua m·ªçi ki·ªÉm tra. B·∫Øt ƒë·∫ßu ƒë·ªçc file...');
            // ‚≠ê B·∫ÆT ƒê·∫¶U ƒê·ªåC FILE V√Ä CHUY·ªÇN TH√ÄNH BASE64 ‚≠ê
            const reader = new FileReader();

            reader.onload = function (e) {
                const base64Content = e.target.result.split(',')[1];
                const submitTime = new Date().toISOString();

                // ‚≠ê B∆Ø·ªöC 1: G·ª¨I D·ªÆ LI·ªÜU ƒê·ªÇ C# L∆ØU FILE V√Ä T·∫†O ƒê∆Ø·ªúNG D·∫™N SQL ‚≠ê
                const submissionData = {
                    Action: "SUBMIT_ASSIGNMENT_SAVE_LOCAL",
                    AssignmentID: assignmentId, // D√πng bi·∫øn s·ªë ƒë√£ parse
                    FileName: fileInput.name,
                    FileBase64: base64Content,
                    StudentNote: studentNote,
                    SubmissionTime: submitTime,
                    CourseName: assignment.tenKhoaHoc,
                    // ‚≠ê ƒê∆Ø·ªúNG D·∫™N G·ªêC C·∫¶N L∆ØU (C# s·∫Ω x·ª≠ l√Ω) ‚≠ê
                    RootPath: "C:\\Submissions\\"
                };

                // G·ª≠i JSON ch·ª©a Base64 v√† c√°c th√¥ng tin c·∫ßn thi·∫øt sang C#
                window.chrome.webview.postMessage(JSON.stringify(submissionData));

                // Gi·∫£ l·∫≠p c·∫≠p nh·∫≠t tr·∫°ng th√°i FE v√† th√¥ng b√°o
                if (index !== -1) {
                    assignmentData[index].trangThai = 'Ch·ªù ch·∫•m';
                    assignmentData[index].statusColor = 'badge-warning';
                    assignmentData[index].daHoanThanh = true;
                    assignmentData[index].ngayNopFormat = new Date().toLocaleDateString('vi-VN') + ' ' + new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
                    assignmentData[index].fileBaiNop = fileInput.name;
                    assignmentData[index].ghiChuSinhVien = studentNote;

                    // ‚≠ê GI·∫¢ L·∫¨P ƒê∆Ø·ªúNG D·∫™N M√Ä C# S·∫º L∆ØU ‚≠ê
                    const estimatedPath = `C:\\Submissions\\${assignment.tenKhoaHoc}\\${assignment.tenBaiTap}_${fileInput.name}`;
                    console.log(`[FE Estimation] C# s·∫Ω l∆∞u file t·∫°i: ${estimatedPath}`);
                }

                alert(`N·ªôp b√†i th√†nh c√¥ng!\n\nB√†i t·∫≠p "${assignment.tenBaiTap}" ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn gi·∫£ng vi√™n. C# ƒëang x·ª≠ l√Ω l∆∞u file c·ª•c b·ªô t·∫°i th∆∞ m·ª•c C:\\Submissions\\...`);
                closeModal();
                loadAssignments(assignmentData);
            };

            reader.readAsDataURL(fileInput);
        }
        function uploadFileToServer(file) {
            return new Promise((resolve, reject) => {
                // Gi·∫£ l·∫≠p m·ªôt ƒë·ªô tr·ªÖ 1 gi√¢y cho qu√° tr√¨nh upload
                setTimeout(() => {
                    if (file.name.includes('error')) {
                        reject('Upload failed for simulated error file.');
                    } else {
                        // T·∫°o m·ªôt URL gi·∫£ l·∫≠p cho file
                        const fileUrl = `https://storage.example.com/assignments/${Date.now()}_${file.name}`;
                        resolve({
                            fileUrl: fileUrl,
                            fileName: file.name
                        });
                    }
                }, 1000); // ƒê·ª£i 1 gi√¢y
            });
        }
        // H√†m m·ªõi ƒë·ªÉ hi·ªÉn th·ªã ghi ch√∫ c·ªßa gi√°o vi√™n
        function showTeacherNote(assignmentIdString) {
            const assignmentId = parseInt(assignmentIdString);
            const assignment = assignmentData.find(a => a.assignmentID === assignmentId);

            if (assignment && assignment.nhanXetGiaoVien) {
                // S·ª≠ d·ª•ng alert ƒë·ªÉ hi·ªÉn th·ªã ghi ch√∫
                alert(`Ghi ch√∫ c·ªßa Gi√°o vi√™n cho b√†i t·∫≠p "${assignment.tenBaiTap}":\n\n${assignment.nhanXetGiaoVien}`);
            } else if (assignment) {
                alert(`B√†i t·∫≠p "${assignment.tenBaiTap}" ch∆∞a c√≥ ghi ch√∫ t·ª´ gi√°o vi√™n.`);
            } else {
                alert('L·ªói: Kh√¥ng t√¨m th·∫•y b√†i t·∫≠p n√†y.');
            }
        }
        // ‚≠ê H√ÄM M·ªöI: X·ª≠ l√Ω hi·ªÉn th·ªã chi ti·∫øt b√†i t·∫≠p ‚≠ê
        function openDetailModal(assignmentIdString) {
            const assignmentId = parseInt(assignmentIdString);
            // T√¨m ƒë·ªëi t∆∞·ª£ng b√†i t·∫≠p trong m·∫£ng assignmentData
            const assignment = assignmentData.find(a => a.assignmentID === assignmentId);

            if (assignment) {
                let details = `
            T√™n b√†i t·∫≠p: ${assignment.tenBaiTap}
            Kh√≥a h·ªçc: ${assignment.tenKhoaHoc}
            H·∫°n n·ªôp: ${assignment.hanNopFormat}
            Tr·∫°ng th√°i: ${assignment.trangThai}
            
            --- M√¥ t·∫£ Chi ti·∫øt ---
            ${assignment.moTa || 'Kh√¥ng c√≥ m√¥ t·∫£.'}
        `;

                // 1. Ki·ªÉm tra v√† th√™m th√¥ng tin k·∫øt qu·∫£ (ƒëi·ªÉm v√† ghi ch√∫)
                if (assignment.diemDat !== null) {
                    details += `
                
                --- K·∫øt qu·∫£ ch·∫•m ƒëi·ªÉm ---
                ƒêi·ªÉm ƒë·∫°t: ${assignment.diemDat} / ${assignment.diemToiDa}
            `;

                    // 2. Tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa b·∫°n: Ghi ch√∫ Gi√°o vi√™n
                    // Thu·ªôc t√≠nh ghi ch√∫ gi√°o vi√™n l√† 'ghiChuGiaoVien'
                    if (assignment.nhanXetGiaoVien) {
                        details += `
                Nh·∫≠n xet Gi√°o vi√™n: ${assignment.nhanXetGiaoVien}`;
                    } else {
                        details += `
                Nh·∫≠n x√©t Gi√°o vi√™n: Kh√¥ng c√≥.`;
                    }
                } else if (assignment.daHoanThanh) {
                    details += `
            
            B√†i t·∫≠p ƒë√£ ƒë∆∞·ª£c n·ªôp v√†o: ${assignment.ngayNopFormat}. ƒêang ch·ªù gi√°o vi√™n ch·∫•m ƒëi·ªÉm.`;
                }

                // Hi·ªán chi ti·∫øt b√†i t·∫≠p b·∫±ng h·ªôp tho·∫°i ƒë∆°n gi·∫£n (alert)
                alert("CHI TI·∫æT B√ÄI T·∫¨P\n\n" + details);

                // L∆∞u √Ω: N·∫øu b·∫°n mu·ªën hi·ªÉn th·ªã chi ti·∫øt trong m·ªôt Modal ƒë·∫πp m·∫Øt, 
                // b·∫°n c·∫ßn t·∫°o th√™m m√£ HTML cho modal ƒë√≥ (v√≠ d·ª•: <div id="detailModal" class="modal">...) 
                // v√† thay th·∫ø alert() b·∫±ng code hi·ªÉn th·ªã modal.

            } else {
                alert('L·ªói: Kh√¥ng t√¨m th·∫•y chi ti·∫øt b√†i t·∫≠p n√†y.');
            }
        }
        // H√†m ƒë√≥ng Modal chi ti·∫øt
        function closeModal() {
            console.log("hello")
            document.getElementById('submitModal').classList.remove('active');
        }
       
        // H√†m m·ªü Modal Chi Ti·∫øt B√†i T·∫≠p (ƒê√£ s·ª≠a l·ªói t√™n thu·ªôc t√≠nh v√† d√πng Modal)
        function openDetailModal(assignmentIdString, highlightNote = false) {
            const assignmentId = parseInt(assignmentIdString);
            const assignment = assignmentData.find(a => a.assignmentID === assignmentId);

            if (!assignment) {
                alert('L·ªói: Kh√¥ng t√¨m th·∫•y chi ti·∫øt b√†i t·∫≠p n√†y.');
                return;
            }

            // ‚≠ê ƒê·ªï d·ªØ li·ªáu v√†o Modal ‚≠ê
            document.getElementById('detailAssignmentName').textContent = assignment.tenBaiTap;
            document.getElementById('detailCourseName').textContent = assignment.tenKhoaHoc;
            document.getElementById('detailStatus').textContent = assignment.trangThai;
            document.getElementById('detailDescription').innerHTML = assignment.moTa || 'Kh√¥ng c√≥ m√¥ t·∫£ chi ti·∫øt.';

            const scoreSection = document.getElementById('detailScoreSection');
            const teacherNoteSection = document.getElementById('detailTeacherNoteSection');
            const detailTeacherNote = document.getElementById('detailTeacherNote');

            // X·ª≠ l√Ω ph·∫ßn ƒëi·ªÉm v√† ghi ch√∫ (diemDat !== null)
            if (assignment.diemDat !== null) {
                scoreSection.style.display = 'block';
                document.getElementById('detailScore').textContent = `${assignment.diemDat} / ${assignment.diemToiDa}`;

                // Ki·ªÉm tra Ghi ch√∫ Gi√°o vi√™n (D√πng NhanXetGiaoVien)
                if (assignment.NhanXetGiaoVien) {
                    teacherNoteSection.style.display = 'block';
                    detailTeacherNote.innerHTML = assignment.NhanXetGiaoVien;
                } else {
                    teacherNoteSection.style.display = 'none';
                }
            } else {
                scoreSection.style.display = 'none';
                teacherNoteSection.style.display = 'none';
            }

            // Hi·ªÉn th·ªã Modal
            document.getElementById('detailModal').classList.add('active');

            // ‚≠ê Logic cu·ªôn (n·∫øu ƒë∆∞·ª£c g·ªçi t·ª´ n√∫t Ghi ch√∫ Gi√°o vi√™n) ‚≠ê
            if (highlightNote) {
                setTimeout(() => {
                    teacherNoteSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    detailTeacherNote.classList.add('highlight-pulse'); // Th√™m hi·ªáu ·ª©ng nh·∫•p nh√°y (c·∫ßn CSS)
                    setTimeout(() => {
                        detailTeacherNote.classList.remove('highlight-pulse');
                    }, 1500);
                }, 100);
            }
        }
        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                if (window.chrome && window.chrome.webview) {
                    window.chrome.webview.postMessage("LOGOUT");
                } else {
                    alert("Ch·ª©c nƒÉng ƒëƒÉng xu·∫•t ch·ªâ ho·∫°t ƒë·ªông trong m√¥i tr∆∞·ªùng WebView2.");
                }
            }
        }
        // H√†m: G·ª≠i tin nh·∫Øn ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn C# (Gi·ªØ nguy√™n)
        function navigateTo(page) {
            window.chrome.webview.postMessage(page);
        }

        // H√†m: ƒêƒÉng xu·∫•t (Gi·ªØ nguy√™n)
        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                window.chrome.webview.postMessage("LOGOUT");
            }
        }
        function navigateToAssignment() {
            if (window.chrome && window.chrome.webview) {
                // G·ª≠i th√¥ng ƒëi·ªáp "ASSIGNMENT" v·ªÅ C#
                window.chrome.webview.postMessage("ASSIGNMENT");
            }
        }
    </script>
</body>
</html>