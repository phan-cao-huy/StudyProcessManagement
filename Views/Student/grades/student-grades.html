<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêi·ªÉm S·ªë - H·ªçc Vi√™n</title>
    <style>

        /* CSS Styling (Kh√¥ng thay ƒë·ªïi, gi·ªØ nguy√™n) */
                * {
                        margin: 0;
                        padding: 0;
                        box-sizing: border-box;

        }

                body {
                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        background: #f5f5f5;
                        display: flex;
                        height: 100vh;
                        overflow: hidden;

        }

                .sidebar {
                        width: 250px;
                        background: #2c3e50;
                        color: white;
                        display: flex;
                        flex-direction: column;
                        box-shadow: 2px 0 5px rgba(0,0,0,0.1);

        }

                .sidebar-header {
                        padding: 20px;
                        background: #34495e;
                        text-align: center;
                        border-bottom: 1px solid #465a6d;

        }

                    .sidebar-header h2 {
                            font-size: 18px;
                            margin-bottom: 5px;

        }

                    .sidebar-header p {
                            font-size: 12px;
                            color: #95a5a6;

        }

                .sidebar-menu {
                        flex: 1;
                        overflow-y: auto;
                        padding: 10px 0;

        }

                .menu-section {
                        margin-bottom: 20px;

        }

                .menu-title {
                        padding: 10px 20px;
                        font-size: 11px;
                        color: #95a5a6;
                        text-transform: uppercase;
                        font-weight: 600;

        }

                .menu-item {
                        padding: 12px 20px;
                        cursor: pointer;
                        transition: all 0.3s;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        color: #ecf0f1;
                        font-size: 14px;

        }

                    .menu-item:hover {
                            background: #34495e;
                            border-left: 3px solid #3498db;

        }

                    .menu-item.active {
                            background: #34495e;
                            border-left: 3px solid #3498db;

        }

                .sidebar-footer {
                        padding: 15px 20px;
                        background: #34495e;
                        border-top: 1px solid #465a6d;

        }

                .user-info {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        margin-bottom: 10px;

        }

                .user-avatar {
                        width: 35px;
                        height: 35px;
                        background: #3498db;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-weight: bold;

        }

                .user-details {
                        flex: 1;

        }

                .user-name {
                        font-size: 13px;
                        font-weight: 600;

        }

                .user-role {
                        font-size: 11px;
                        color: #95a5a6;

        }

                .btn-logout {
                        width: 100%;
                        padding: 8px;
                        background: #e74c3c;
                        border: none;
                        border-radius: 4px;
                        color: white;
                        font-size: 13px;
                        cursor: pointer;
                        font-weight: 600;

        }

                .main-content {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        overflow: hidden;

        }

                .topbar {
                        background: white;
                        padding: 15px 25px;
                        border-bottom: 1px solid #ddd;

        }

                    .topbar h1 {
                            font-size: 20px;
                            color: #333;
                            margin-bottom: 5px;

        }

                .breadcrumb {
                        font-size: 13px;
                        color: #666;

        }

                .content-area {
                        flex: 1;
                        overflow-y: auto;
                        padding: 25px;

        }


        /* ƒê√£ x√≥a .stats-grid v√† .stat-card CSS v√¨ kh√¥ng c√≤n s·ª≠ d·ª•ng */
                .card {
                        background: white;
                        border-radius: 8px;
                        border: 1px solid #e0e0e0;
                        margin-bottom: 20px;

        }

                .card-header {
                        padding: 15px 20px;
                        border-bottom: 1px solid #e0e0e0;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;

        }

                    .card-header h3 {
                            font-size: 16px;
                            color: #333;

        }

                table {
                        width: 100%;
                        border-collapse: collapse;

        }

                    table th {
                            background: #f9f9f9;
                            padding: 12px;
                            text-align: left;
                            font-size: 13px;
                            color: #333;
                            font-weight: 600;
                            border-bottom: 1px solid #e0e0e0;

        }

                    table td {
                            padding: 12px;
                            font-size: 13px;
                            color: #666;
                            border-bottom: 1px solid #f5f5f5;

        }

                    table tr:hover {
                            background: #f9f9f9;

        }

                .grade-display {
                        font-size: 18px;
                        font-weight: bold;
                        padding: 8px 16px;
                        border-radius: 8px;
                        text-align: center;
                        display: inline-block;
                        min-width: 60px;

        }

                .grade-excellent {
                        background: #e8f5e9;
                        color: #2e7d32;

        }

                .grade-good {
                        background: #e3f2fd;
                        color: #1976d2;

        }

                .grade-average {
                        background: #fff3e0;
                        color: #f57c00;

        }

                #grades-detail-card {
                        display: none;

        }

                #main-content {
                        visibility: hidden;
                        opacity: 0;
                        transition: opacity 0.1s ease-in;

        }

                    #main-content.loaded {
                            visibility: visible;
                            opacity: 1;

        }


    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>üéì LMS Student</h2>
            <p>Learning Management System</p>
        </div>

        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-title">T·ªîNG QUAN</div>
                <div class="menu-item" onclick="navigateTo('INFORMATION')">
                    <span>üë§</span>
                    <span>Th√¥ng tin c√° nh√¢n</span>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-title">H·ªåC T·∫¨P</div>
                <div class="menu-item" onclick="navigateTo('MY_COURSES')">
                    <span>üìö</span>
                    <span>Kh√≥a h·ªçc c·ªßa t√¥i</span>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-title">B√ÄI T·∫¨P & KI·ªÇM TRA</div>
                <div class="menu-item" onclick="navigateTo('ASSIGNMENT')">
                    <span>üìù</span>
                    <span>B√†i t·∫≠p</span>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-title">K·∫æT QU·∫¢</div>
                <div class="menu-item active" onclick="navigateTo('GRADES')">
                    <span>üèÜ</span>
                    <span>ƒêi·ªÉm s·ªë</span>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-title">KH√ÅC</div>
                <div class="menu-item" onclick="navigateTo('CONTENT')">
                    <span>üìÅ</span>
                    <span>T√†i nguy√™n</span>
                </div>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">S</div>
                <div class="user-details">
                    <div class="user-name">Student</div>
                    <div class="user-role">H·ªçc vi√™n</div>
                </div>
            </div>
            <button class="btn-logout" onclick="logout()">üö™ ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <div class="main-content" id="main-content">
        <div class="topbar">
            <h1>ƒêi·ªÉm S·ªë</h1>
            <div class="breadcrumb">Trang ch·ªß / K·∫øt qu·∫£ / ƒêi·ªÉm s·ªë</div>
        </div>

        <div class="content-area">
            <div class="card" id="grades-detail-card">
                <div class="card-header">
                    <h3>ƒêi·ªÉm theo kh√≥a h·ªçc (Chi ti·∫øt t·ª´ng b√†i)</h3>
                </div>
                <div style="padding: 0;">
                    <table>
                        <thead>
                            <tr>
                                <th>Kh√≥a h·ªçc</th>
                                <th>B√†i t·∫≠p</th>
                                <th>ƒêi·ªÉm</th>
                                <th>Ng√†y ch·∫•m</th>
                                <th>Nh·∫≠n x√©t</th>
                            </tr>
                        </thead>
                        <tbody id="grades-table-body">
                            <tr><td colspan="5" style="text-align: center; font-style: italic;">Kh√¥ng c√≥ d·ªØ li·ªáu chi ti·∫øt t·ª´ng b√†i t·∫≠p ƒë∆∞·ª£c g·ª≠i t·ª´ C#. Vui l√≤ng xem b·∫£ng T√≥m t·∫Øt.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>T·ªïng k·∫øt theo kh√≥a h·ªçc</h3>
                </div>
                <div style="padding: 0;">
                    <table>
                        <thead>
                            <tr>
                                <th>Kh√≥a h·ªçc</th>
                                <th>S·ªë b√†i ƒë√£ ch·∫•m</th>
                                <th>ƒêi·ªÉm TB</th>
                                <th>ƒêi·ªÉm cao nh·∫•t</th>
                                <th>ƒêi·ªÉm th·∫•p nh·∫•t</th>
                            </tr>
                        </thead>
                        <tbody id="course-summary-table-body">
                            <tr><td colspan="5" style="text-align: center; font-style: italic;">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    ---

    <script>
        // H√†m: G·ª≠i tin nh·∫Øn ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn C# (Gi·ªØ nguy√™n)
        function navigateTo(page) {
            window.chrome.webview.postMessage(page);
        }

        // H√†m: ƒêƒÉng xu·∫•t (Gi·ªØ nguy√™n)
        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                window.chrome.webview.postMessage("LOGOUT");
            }
        }

        // ------------------------------------------------------------
        // ## LOGIC C·∫¨P NH·∫¨T & HI·ªÇN TH·ªä D·ªÆ LI·ªÜU ƒêI·ªÇM S·ªê
        // ------------------------------------------------------------

        // H√†m: Reset t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ UI v·ªÅ tr·∫°ng th√°i m·∫∑c ƒë·ªãnh (CH·ªà C√íN RESET B·∫¢NG)
        function resetUI() {
            console.log("[RESET] Clearing courses data...");

            const mainContent = document.getElementById('main-content');
            if (mainContent) {
                mainContent.classList.add('loaded');
            }

            // **QUAN TR·ªåNG: X√ìA HO√ÄN TO√ÄN N·ªòI DUNG B·∫¢NG T·ªîNG K·∫æT**
            const summaryBody = document.getElementById('course-summary-table-body');
            if (summaryBody) {
                summaryBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>';
            }

            // X√≥a b·∫£ng chi ti·∫øt (Gi·ªØ nguy√™n)
            const detailBody = document.getElementById('grades-table-body');
            if (detailBody) {
                detailBody.innerHTML = '<tr><td colspan="5" style="text-align: center; font-style: italic;">Kh√¥ng c√≥ d·ªØ li·ªáu chi ti·∫øt t·ª´ng b√†i t·∫≠p ƒë∆∞·ª£c g·ª≠i t·ª´ C#. Vui l√≤ng xem b·∫£ng T√≥m t·∫Øt.</td></tr>';
            }

            console.log("[RESET] UI cleared successfully");
        }

        // ‚ö°Ô∏è CH·ªêNG CACHE: Reset UI ngay l·∫≠p t·ª©c + X√≥a m·ªçi d·ªØ li·ªáu c≈© (Gi·ªØ nguy√™n)
        (function () {
            console.log("[ANTI-CACHE] Forcing complete UI reset on load");
            resetUI();
            try {
                sessionStorage.clear();
                localStorage.clear();
            } catch (e) {
                console.log("[ANTI-CACHE] No storage to clear");
            }
        })();

        // H√†m: C·∫≠p nh·∫≠t d·ªØ li·ªáu t·ª´ C#
        window.updateGradesAndSummary = function (jsonString) {
            console.log("[UPDATE] Received data from C#, resetting UI first...");

            // B∆Ø·ªöC 1: LU√îN RESET UI ƒê·ªÇ X√ìA D·ªÆ LI·ªÜU C≈®
            resetUI();

            // B∆Ø·ªöC 2: Delay nh·ªè ƒë·ªÉ ƒë·∫£m b·∫£o DOM ƒë√£ reset ho√†n to√†n
            setTimeout(() => {
                try {
                    console.log("[UPDATE] Parsing JSON data...");
                    const data = JSON.parse(jsonString);

                    // H√†m helper ƒë·ªÉ format s·ªë (Gi·ªØ nguy√™n)
                    const formatSummaryScore = (score) => (score !== null && score !== undefined && !Number.isNaN(score)) ? score.toFixed(1) : '0.0';

                    // H√†m helper ƒë·ªÉ t·∫°o class m√†u cho ƒëi·ªÉm (Gi·ªØ nguy√™n)
                    const getGradeClass = (score) => {
                        const numericScore = (score !== null && score !== undefined && !Number.isNaN(score)) ? score : 0;
                        if (numericScore >= 8.5) return 'grade-excellent';
                        if (numericScore >= 7.0) return 'grade-good';
                        return 'grade-average';
                    };

                    // **ƒê√É X√ìA LOGIC C·∫¨P NH·∫¨T TH·ªêNG K√ä T·ªîNG QUAN**

                    // 2. C·∫¨P NH·∫¨T B·∫¢NG T·ªîNG K·∫æT KH√ìA H·ªåC
                    const courses = data.courses || [];
                    const summaryBody = document.getElementById('course-summary-table-body');
                    summaryBody.innerHTML = ''; // **X√ìA HO√ÄN TO√ÄN TR∆Ø·ªöC KHI TH√äM M·ªöI**

                    if (courses.length === 0) {
                        summaryBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">Kh√¥ng c√≥ d·ªØ li·ªáu t·ªïng k·∫øt kh√≥a h·ªçc.</td></tr>';
                    } else {
                        courses.forEach(course => {
                            const tr = document.createElement('tr');
                            const diemTB = formatSummaryScore(course.diemTB);
                            const diemCaoNhat = formatSummaryScore(course.diemCaoNhat);
                            const diemThapNhat = formatSummaryScore(course.diemThapNhat);
                            const soBaiDaCham = course.soBaiDaCham !== null && course.soBaiDaCham !== undefined ? course.soBaiDaCham : 0;

                            tr.innerHTML = `
                                                <td><strong>${course.khoaHoc || 'N/A'}</strong></td>
                                                <td>${soBaiDaCham} b√†i</td>
                                                <td><div class="grade-display ${getGradeClass(course.diemTB)}">${diemTB}</div></td>
                                                <td>${diemCaoNhat}</td>
                                                <td>${diemThapNhat}</td>
                                            `;
                            summaryBody.appendChild(tr);
                        });
                    }

                    console.log("[UPDATE] Data updated successfully");
                } catch (error) {
                    console.error("[ERROR] Failed to parse/update grades data:", error);
                    const summaryBody = document.getElementById('course-summary-table-body');
                    summaryBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #e74c3c; font-weight: bold;">L·ªñI: Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu ƒëi·ªÉm s·ªë.</td></tr>';
                }
            }, 50); // Delay 50ms ƒë·ªÉ ƒë·∫£m b·∫£o DOM ƒë√£ reset
        };
    </script>
</body>
</html>