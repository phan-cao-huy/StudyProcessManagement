<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√†i Nguy√™n H·ªçc T·∫≠p C·ªßa T√¥i</title>
    <style>
        /* CSS g·ªëc c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ƒë∆∞a v√†o ƒë√¢y */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 250px; background: #2c3e50; color: white; display: flex; flex-direction: column; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
        .sidebar-header { padding: 20px; background: #34495e; text-align: center; border-bottom: 1px solid #465a6d; }
        .sidebar-header h2 { font-size: 18px; margin-bottom: 5px; }
        .sidebar-header p { font-size: 12px; color: #95a5a6; }
        .sidebar-menu { flex: 1; overflow-y: auto; padding: 10px 0; }
        .menu-section { margin-bottom: 20px; }
        .menu-title { padding: 10px 20px; font-size: 11px; color: #95a5a6; text-transform: uppercase; font-weight: 600; }
        .menu-item { padding: 12px 20px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 12px; color: #ecf0f1; font-size: 14px; }
        .menu-item:hover { background: #34495e; border-left: 3px solid #3498db; }
        .menu-item.active { background: #34495e; border-left: 3px solid #3498db; }
        .sidebar-footer { padding: 15px 20px; background: #34495e; border-top: 1px solid #465a6d; }
        .user-info { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .user-avatar { width: 35px; height: 35px; background: #3498db; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .user-details { flex: 1; }
        .user-name { font-size: 13px; font-weight: 600; }
        .user-role { font-size: 11px; color: #95a5a6; }
        .btn-logout { width: 100%; padding: 8px; background: #e74c3c; border: none; border-radius: 4px; color: white; font-size: 13px; cursor: pointer; font-weight: 600; }
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .topbar { background: white; padding: 15px 25px; border-bottom: 1px solid #ddd; }
        .topbar h1 { font-size: 20px; color: #333; margin-bottom: 5px; }
        .breadcrumb { font-size: 13px; color: #666; }
        .content-area { flex: 1; overflow-y: auto; padding: 25px; }
        .profile-container { max-width: 1200px; margin: 0 auto; }
        .info-card { background: white; border-radius: 8px; padding: 25px; border: 1px solid #e0e0e0; margin-bottom: 20px; }
        .badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .badge-success { background: #e8f5e9; color: #2e7d32; }
        .badge-danger { background: #ffebee; color: #c62828; }
        .badge-warning { background: #fff3e0; color: #f57c00; }
        .badge-info { background: #e3f2fd; color: #1e88e5; }
        .badge-primary { background: #e1f5fe; color: #039be5; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 600; text-align: center; }
        .btn-primary { background: #3498db; color: white; }
        /* NEW STYLES for Resource Page */
        .resource-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .resource-controls select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
            min-width: 150px;
        }
        .resource-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .resource-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s;
            border-left: 5px solid;
            display: flex;
            flex-direction: column;
        }
        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        .resource-lesson { border-left-color: #3498db; }
        .resource-assignment { border-left-color: #e67e22; }

        .resource-body {
            padding: 15px;
            flex-grow: 1;
        }
        .resource-type {
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .resource-card h4 {
            font-size: 16px;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        .resource-chapter, .resource-course {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 8px;
            display: block;
        }
        .resource-description {
            font-size: 13px;
            color: #555;
            margin-bottom: 10px;
            height: 40px; 
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .resource-footer {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fcfcfc;
        }
        .resource-date {
            font-size: 11px;
            color: #999;
        }
        .action-button {
            padding: 6px 12px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-view { background: #2ecc71; color: white; }
        .btn-view:hover { background: #27ae60; }
        
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>üéì LMS Student</h2>
            <p>Learning Management System</p>
        </div>

        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-title">T·ªîNG QUAN</div>

                <div class="menu-item" onclick="navigateTo('INFORMATION')">
                    <span>üë§</span>
                    <span>Th√¥ng tin c√° nh√¢n</span>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-title">H·ªåC T·∫¨P</div>

                <div class="menu-item" onclick="location.href='../courses/student-my-courses.html'">
                    <span>üìö</span>
                    <span>Kh√≥a h·ªçc c·ªßa t√¥i</span>
                </div>

            </div>

            <div class="menu-section">
                <div class="menu-title">B√ÄI T·∫¨P & KI·ªÇM TRA</div>
                <div class="menu-item" onclick="navigateToAssignment()">
                    <span>üìù</span>
                    <span>B√†i t·∫≠p</span>
                </div>

            </div>

            <div class="menu-section">
                <div class="menu-title">K·∫æT QU·∫¢</div>

                <div class="menu-item" onclick="navigateTo('GRADES')">
                    <span>üèÜ</span>
                    <span>ƒêi·ªÉm s·ªë</span>
                </div>

            </div>

            <div class="menu-section">
                <div class="menu-title">KH√ÅC</div>
                <div class="menu-item" onclick="navigateTo('CONTENT')">
                    <span>üìÅ</span>
                    <span>T√†i nguy√™n</span>
                </div>

            </div>
        </div>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">S</div>
                <div class="user-details">
                    <div class="user-name">Student</div>
                    <div class="user-role">H·ªçc vi√™n</div>
                </div>
            </div>
            <button class="btn-logout" onclick="logout()">üö™ ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <div class="main-content">
        <div class="topbar">
            <h1>T·∫•t C·∫£ T√†i Nguy√™n H·ªçc T·∫≠p</h1>
            <div class="breadcrumb">Trang ch·ªß / H·ªçc t·∫≠p / T√†i nguy√™n h·ªçc t·∫≠p</div>
        </div>

        <div class="content-area">
            <div class="profile-container">
                
                <div class="resource-controls">
                    <div>
                        <label for="filterCourse">Kh√≥a h·ªçc:</label>
                        <select id="filterCourse" onchange="filterResources()">
                            <option value="">T·∫•t c·∫£ Kh√≥a h·ªçc</option>
                            </select>
                    </div>
                    <div>
                        <label for="filterType">Lo·∫°i T√†i nguy√™n:</label>
                        <select id="filterType" onchange="filterResources()">
                            <option value="">T·∫•t c·∫£ Lo·∫°i</option>
                            <option value="Lesson">B√†i h·ªçc</option>
                            <option value="Assignment">B√†i t·∫≠p</option>
                        </select>
                    </div>
                    <div>
                        <label for="filterStatus">Tr·∫°ng th√°i:</label>
                        <select id="filterStatus" onchange="filterResources()">
                            <option value="">T·∫•t c·∫£ Tr·∫°ng th√°i</option>
                            <option value="Ho√†n th√†nh">Ho√†n th√†nh</option>
                            <option value="Ch∆∞a b·∫Øt ƒë·∫ßu">Ch∆∞a b·∫Øt ƒë·∫ßu</option>
                            <option value="ƒêang l√†m">ƒêang l√†m</option>
                            <option value="Ch∆∞a n·ªôp">Ch∆∞a n·ªôp</option>
                            <option value="ƒê√£ n·ªôp">ƒê√£ n·ªôp</option>
                        </select>
                    </div>
                </div>

                <div class="resource-list" id="jsResourceList">
                    <div style="text-align: center; padding: 50px; color: #999;">ƒêang t·∫£i t√†i nguy√™n...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // M√î PH·ªéNG D·ªÆ LI·ªÜU StudentContent t·ª´ C#
        let allResources = [];

        // ‚≠ê H√ÄM NH·∫¨N D·ªÆ LI·ªÜU T·ª™ C# V√Ä HI·ªÇN TH·ªä L√äN FE ‚≠ê
        window.renderResources = function (jsonString) {
            try {
                const data = JSON.parse(jsonString);
                allResources = data;

                // S·∫Øp x·∫øp theo th·ª© t·ª± h·ªçc t·∫≠p: CourseID > ThuTuChuong > ThuTu
                data.sort((a, b) => {
                    if (a.CourseID !== b.CourseID) return a.CourseID - b.CourseID;
                    if (a.ThuTuChuong !== b.ThuTuChuong) return a.ThuTuChuong - b.ThuTuChuong;
                    return a.ThuTu - b.ThuTu;
                });

                loadCourseOptions(allResources);

                const listContainer = document.getElementById('jsResourceList');
                if (!data || data.length === 0) {
                    listContainer.innerHTML = '<div style="text-align: center; padding: 50px; color: #999;">Kh√¥ng t√¨m th·∫•y t√†i nguy√™n n√†o.</div>';
                    return;
                }

                listContainer.innerHTML = data.map(renderResourceCard).join('');

            } catch (e) {
                console.error("L·ªói khi ph√¢n t√≠ch JSON t·ª´ C#:", e);
                document.getElementById('jsResourceList').innerHTML = '<div style="text-align: center; padding: 50px; color: red;">L·ªói t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.</div>';
            }
        };

        // H√†m t·∫£i c√°c t√πy ch·ªçn Kh√≥a h·ªçc v√†o b·ªô l·ªçc (Gi·ªØ nguy√™n)
        function loadCourseOptions(resources) {
            const courseSelect = document.getElementById('filterCourse');
            courseSelect.innerHTML = '<option value="">T·∫•t c·∫£ Kh√≥a h·ªçc</option>';

            const uniqueCoursesMap = new Map();
            resources.forEach(r => {
                if (!uniqueCoursesMap.has(r.CourseID)) {
                    uniqueCoursesMap.set(r.CourseID, r.TenKhoaHoc);
                }
            });

            uniqueCoursesMap.forEach((name, id) => {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = name;
                courseSelect.appendChild(option);
            });
        }

        // ‚≠ê S·ª¨A ƒê·ªîI QUAN TR·ªåNG: G·ª≠i ResourceID, Type v√† Action v·ªÅ C# ‚≠ê
        function renderResourceCard(resource) {
            const isLesson = resource.LoaiTaiNguyen === 'Lesson';
            let badgeClass, statusText, actionText;

            // 1. X√°c ƒë·ªãnh n√∫t h√†nh ƒë·ªông
            switch (resource.TrangThai) {
                case 'Ho√†n th√†nh':
                    badgeClass = 'badge-success';
                    statusText = 'Ho√†n th√†nh';
                    actionText = 'Xem l·∫°i';
                    break;
                case 'ƒêang h·ªçc':
                case 'ƒêang l√†m':
                    badgeClass = 'badge-warning';
                    statusText = resource.TrangThai;
                    actionText = 'Ti·∫øp t·ª•c';
                    break;
                case 'ƒê√£ n·ªôp':
                    badgeClass = 'badge-info';
                    statusText = 'ƒê√£ n·ªôp';
                    actionText = 'Chi ti·∫øt';
                    break;
                case 'Ch∆∞a n·ªôp':
                    badgeClass = 'badge-danger';
                    statusText = 'Ch∆∞a n·ªôp';
                    actionText = 'N·ªôp b√†i'; // ƒê·ªïi th√†nh N·ªôp b√†i cho Assignment
                    break;
                case 'Ch∆∞a b·∫Øt ƒë·∫ßu':
                default:
                    badgeClass = 'badge-primary';
                    statusText = 'Ch∆∞a b·∫Øt ƒë·∫ßu';
                    actionText = 'B·∫Øt ƒë·∫ßu';
                    break;
            }

            const resourceDate = resource.NgayDang ? new Date(resource.NgayDang).toLocaleDateString('vi-VN') : 'N/A';
            const dateLabel = isLesson ? 'Ng√†y ƒëƒÉng' : 'H·∫°n n·ªôp:';
            const typeLabel = isLesson ? 'B√†i h·ªçc' : 'B√†i t·∫≠p';
            const typeEmoji = isLesson ? 'üìñ' : 'üìù';

            // X√°c ƒë·ªãnh h√†nh ƒë·ªông (Action) s·∫Ω g·ª≠i ƒëi: VIEW_LESSON ho·∫∑c VIEW_ASSIGNMENT
            const action = isLesson ? 'VIEW_LESSON' : 'VIEW_ASSIGNMENT';

            return `
            <div class="resource-card resource-${isLesson ? 'lesson' : 'assignment'}">
                <div class="resource-body">
                    <div class="resource-type">${typeEmoji} ${typeLabel} <span class="badge ${badgeClass}">${statusText}</span></div>
                    <h4>${resource.TenTaiNguyen}</h4>
                    <span class="resource-course">Kh√≥a h·ªçc: ${resource.TenKhoaHoc}</span>
                    <span class="resource-chapter">Ch∆∞∆°ng: ${resource.TenChuong || 'Ch∆∞a x√°c ƒë·ªãnh'}</span>
                    <p class="resource-description">${resource.MoTa || 'Kh√¥ng c√≥ m√¥ t·∫£.'}</p>
                </div>
                <div class="resource-footer">
                    <div class="resource-date"> </div>
                    <button class="action-button btn-view"¬†
                        onclick="viewResource('${action}', ${resource.ResourceID})">
                        ${actionText}
                    </button>
                </div>
            </div>
        `;
        }

        // H√†m l·ªçc t√†i nguy√™n (Gi·ªØ nguy√™n)
        function filterResources() {
            const courseId = document.getElementById('filterCourse').value;
            const type = document.getElementById('filterType').value;
            const status = document.getElementById('filterStatus').value;

            const filteredData = allResources.filter(r => {
                const matchCourse = courseId === "" || r.CourseID.toString() === courseId;
                const matchType = type === "" || r.LoaiTaiNguyen === type;
                const matchStatus = status === "" || r.TrangThai === status;
                return matchCourse && matchType && matchStatus;
            });

            const listContainer = document.getElementById('jsResourceList');
            if (!filteredData || filteredData.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; padding: 50px; color: #999;">Kh√¥ng t√¨m th·∫•y t√†i nguy√™n n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc.</div>';
                return;
            }

            listContainer.innerHTML = filteredData.map(renderResourceCard).join('');
        }

        // G√°n h√†m filterResources v√†o s·ª± ki·ªán onchange c·ªßa c√°c th·∫ª select
        document.getElementById('filterCourse').onchange = filterResources;
        document.getElementById('filterType').onchange = filterResources;
        document.getElementById('filterStatus').onchange = filterResources;

        // ‚≠ê S·ª¨A ƒê·ªîI QUAN TR·ªåNG: G·ª≠i th√¥ng tin v·ªÅ C# ƒë·ªÉ C# m·ªü URL ‚≠ê
        function viewResource(action, resourceId) {
            // 1. T√¨m resource trong m·∫£ng to√†n c·ª•c
            const resource = allResources.find(r => r.ResourceID === resourceId);

            if (!resource) {
                alert(`L·ªói: Kh√¥ng t√¨m th·∫•y t√†i nguy√™n ID ${resourceId}`);
                return;
            }

            // 2. X·ª≠ l√Ω logic Lesson/Assignment
            if (action === 'VIEW_LESSON') {
                // ƒê·ªëi v·ªõi B√†i h·ªçc, ∆∞u ti√™n LinkVideo (YouTube), n·∫øu kh√¥ng c√≥, d√πng LinkTaiLieu
                const urlToOpen = resource.LinkVideo || resource.LinkTaiLieu;

                if (urlToOpen) {
                    // G·ª≠i Action URL v√† URL v·ªÅ C#
                    if (window.chrome && window.chrome.webview) {
                        window.chrome.webview.postMessage(JSON.stringify({
                            Action: "OPEN_URL",
                            URL: urlToOpen,
                            ResourceType: "Lesson"
                        }));
                    } else {
                        console.warn(`M·ªü B√†i h·ªçc: ${urlToOpen}`);
                        window.open(urlToOpen, '_blank');
                    }
                } else {
                    alert("B√†i h·ªçc n√†y ch∆∞a c√≥ t√†i nguy√™n li√™n k·∫øt.");
                }
            }
            else if (action === 'VIEW_ASSIGNMENT') {
                // ƒê·ªëi v·ªõi B√†i t·∫≠p, g·ª≠i y√™u c·∫ßu v·ªÅ C# ƒë·ªÉ m·ªü Form Assignment
                if (window.chrome && window.chrome.webview) {
                    // G·ª≠i Action Assignment v√† ID b√†i t·∫≠p v·ªÅ C#
                    window.chrome.webview.postMessage(JSON.stringify({
                        Action: "OPEN_ASSIGNMENT_DETAIL",
                        AssignmentID: resourceId
                    }));
                } else {
                    alert(`M·ªü chi ti·∫øt/Form n·ªôp B√†i t·∫≠p ID ${resourceId}`);
                }
            }
        }

        // C√ÅC H√ÄM POSTMESSAGE G·ªêC (Gi·ªØ nguy√™n)
        function logout() {
            if (window.chrome && window.chrome.webview) {
                window.chrome.webview.postMessage("LOGOUT");
            } else {
                console.warn("ƒêƒÉng xu·∫•t (Web mode)");
            }
        }
        function navigateTo(target) {
            if (window.chrome && window.chrome.webview) {
                if (target.includes("student-discover.html")) window.chrome.webview.postMessage("DISCOVER");
                else window.chrome.webview.postMessage(target.split('/').pop().split('-').pop().replace('.html', '').toUpperCase());
            } else {
                console.warn(`ƒêi·ªÅu h∆∞·ªõng t·ªõi: ${target} (Web mode)`);
            }
        }
        function navigateToAssignment() {
            if (window.chrome && window.chrome.webview) {
                window.chrome.webview.postMessage("ASSIGNMENT");
            } else {
                console.warn("ƒêi·ªÅu h∆∞·ªõng t·ªõi B√†i t·∫≠p (Web mode)");
            }
        }
        
        // C√ÅC H√ÄM POSTMESSAGE G·ªêC
        // H√†m: G·ª≠i tin nh·∫Øn ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn C# (Gi·ªØ nguy√™n)
        function navigateTo(page) {
            window.chrome.webview.postMessage(page);
        }

        // H√†m: ƒêƒÉng xu·∫•t (Gi·ªØ nguy√™n)
        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                window.chrome.webview.postMessage("LOGOUT");
            }
        }
        function navigateToAssignment() {
            if (window.chrome && window.chrome.webview) {
                // G·ª≠i th√¥ng ƒëi·ªáp "ASSIGNMENT" v·ªÅ C#
                window.chrome.webview.postMessage("ASSIGNMENT");
            }
        }
        function navigateToAssignment() {
            if (window.chrome && window.chrome.webview) {
                window.chrome.webview.postMessage("ASSIGNMENT");
            } else {
                console.warn("ƒêi·ªÅu h∆∞·ªõng t·ªõi B√†i t·∫≠p (Web mode)");
            }
        }
    </script>
</body>
</html>